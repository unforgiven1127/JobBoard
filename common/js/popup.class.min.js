$.ui.dialog.prototype._focusTabbable=function(){};var CPopup=function(){this.caoPopup={},this.getConfig=function(a,b){a||(a=Math.random().toString(36).substr(4)),b||(b="layer");var c={type:b,tag:a,contentTag:null,persistent:!1,forceRefresh:!1,title:null,buttons:{},width:380,height:190,maxHeight:780,maxWidth:1380,minHeight:40,minWidth:70,position:{},autoOpen:!0,modal:!0,closeOnEscape:!0,closeText:"",dialogClass:"",draggable:!0,resizable:!1,hide:{effect:"fade",delay:0,duration:100},show:{effect:"fade",delay:0,duration:250},close:function(){goPopup.remove(this)}};return c},this.remove=function(a,b){if("string"==typeof a&&(a="#"+a),!$(a).hasClass("ui-dialog-content"))return!1;var c=$(a).attr("id");return $(a).dialog("close"),$(a).closest(".ui-dialog").hide(),b!==!0&&$(a).dialog("option","persistent")?($(a).dialog("option","draggable")&&(this.caoPopup[c].position=$(a).dialog("option","position")),!0):($(a).dialog("destroy"),delete this.caoPopup[c],$(a).remove(),console.log("removed/destroyed "+c),!0)},this.removeAll=function(a){$.map(this.caoPopup,function(b,c){goPopup.remove(b.tag,a)}),this.caoPopup={}},this.removeByType=function(a,b){return a?($.map(this.caoPopup,function(c,d){console.log("remove by type:  popup - ["+d+"] "+c.type+" ? param -"+a),c.type==a&&goPopup.remove(c.tag,b)}),!0):!1},this.removeLastByType=function(a,b){if(!a)return!1;var c="";return $.map(this.caoPopup,function(b,d){return b.type==a?(c=b.tag,!0):void 0}),console.log("removeLastByType --> tag to remove: "+c),this.remove(c,b),!0},this.create=function(a,b,c){return a?((void 0===!b||null===b)&&(b=" &nbsp; "),this.caoPopup[a.tag]=a,(void 0===a.title||null===a.title||a.title===!1)&&(a.title=""),c||$('<div class="popupMessage hidden" id="'+a.tag+'"></div>').html(b).appendTo("body"),$("#"+a.tag).dialog(a),a.tag):""},this.getActive=function(a){var b=null;if(a)switch(a){case"layer":b=$(".ui-dialog.popup_layer:visible:last");break;case"notice":b=$(".ui-dialog.popup_layer:visible:last");break;case"message":b=$(".ui-dialog.popup_message:visible:last");break;default:b=$(".ui-dialog:visible:last")}if(!b)return"";var c=$("div.ui-dialog-content",b).attr("id");if(!c)return"";var d=$("#"+c).dialog("isOpen");return d&&"undefined"!=d?c:""},this.removeActive=function(a){var b=this.getActive(a);return b?(console.log("removeActive -->"+b),this.remove(b)):(console.log("removeActive --> no active layer --> removeLastByType("+a+")"),console.log(this.caoPopup),this.removeLastByType(a))},this.addButton=function(psLabel,psAction,pbKeepPopup){if(pbKeepPopup)var oButton={text:psLabel,click:function(){eval(psAction)}};else var oButton={text:psLabel,id:"close_button",click:function(){eval(psAction),$(this).dialog("close")}};return oButton},this.changeConfig=function(a,b,c){return this.caoPopup[a]?(this.caoPopup[a][b]=c,$("#"+a).dialog("option",b,c),!0):!1},this.setPopupMessage=function(a,b,c,d,e,f){var g=this.getConfig("","msg"),h=!1;return b&&(g.modal=!0),f&&(g.dialogClass=f),"ui-state-error"===f&&(g.open=function(){$("#close_button").focus()},$(".ui-state-error").dialog("isOpen")===!0&&(h=!0)),void 0===c||null===c||c===!1?(g.dialogClass+=" noTitle",g.buttons=[this.addButton("close")]):g.title=c,d&&(g.width=d),e&&(g.height=e),g.dialogClass+=" popup_message",h?!1:this.create(g,a)},this.setErrorMessage=function(a,b,c,d,e){return a=a.split("\n").join("<br />"),this.setPopupMessage(a,b,c,d,e,"ui-state-error")},this.setPopupConfirm=function(psMessage,psConfirmedAction,psRefusedAction,psConfirmedBtn,psRefusedBtn,psTitle,pnWidth,pnHeight){var oPopup=this.getConfig("","confirm");return oPopup.modal=!0,pnWidth&&(oPopup.width=pnWidth),pnHeight&&(oPopup.height=pnHeight),psTitle?oPopup.title=psTitle:oPopup.dialogClass="noTitle",psConfirmedBtn||(psConfirmedBtn="Ok"),psRefusedBtn||(psRefusedBtn="Cancel"),oPopup.dialogClass+=" popup_confirm",oPopup.buttons=[{text:psConfirmedBtn,click:function(){eval(psConfirmedAction),goPopup.remove(this)}},{text:psRefusedBtn,click:function(){eval(psRefusedAction),goPopup.remove(this)}}],oPopup.dialogClass+=" popup_message",this.create(oPopup,psMessage)},this.setNotice=function(psContent,paAction,pbAnimation,pbModal,pnWidth,pnHeight,psClass){var oPopup=this.getConfig("","notice");oPopup.position={at:"right bottom"},oPopup.closeOnEscape=!0,oPopup.dialogClass="notifierPopup popup_notice",oPopup.draggable=!1,oPopup.resizable=!1,pbModal===!0?oPopup.modal=!0:oPopup.modal=!1,pbAnimation!==!1&&(oPopup.dialogClass+=" notifierPopupAnimation"),pnWidth?oPopup.width=pnWidth:oPopup.width=350,pnHeight?oPopup.height=pnHeight:oPopup.height=60,psClass&&(oPopup.dialogClass+=" "+psClass);var sId=this.create(oPopup,psContent);return paAction||(paAction={}),paAction.delay?paAction.delay=parseInt(paAction.delay)-500:paAction.delay=1e3,paAction.timedUrl&&(paAction.url=paAction.timedUrl),paAction.callback?eval(paAction.callback):paAction.url?(setTimeout("window.location.href = '"+paAction.url+"'; ",paAction.delay),setTimeout("window.location.reload(); ",paAction.delay+2500)):setTimeout("goPopup.remove('"+sId+"'); ",paAction.delay+500),sId},this.setLayer=function(a,b,c,d,e,f,g){var h=this.getConfig(a,"layer");return e&&(h.persistent=e),c&&"undefined"!=c&&(h.title=c),d!==!1&&(h.modal=!0),f?h.width=f:h.width=800,g?h.height=g:h.height=600,h.dialogClass+=" popup_layer",this.setLayerByConfig(a,h,b)},this.setLayerByConfig=function(a,b,c){return a||(a=b.tag),this.restorePersistentLayer(b)?!0:(b.type="layer",(void 0===b.title||null===b.title||b.title===!1)&&(b.title=null),b.buttons||null!==b.title||(b.title=""),b.position={my:"center",at:"center",of:window},this.create(b,c))},this.setLayerFromTag=function(a){var b;b="object"==typeof a?$(a):$("#"+a);var c=$(b).data();if(c.length<=0)return!1;var d=this.getConfig($(b).attr("id"),"layer");return $.map(c,function(a,b){"class"==b&&(b="dialogClass"),d[b]=a}),d.dialogClass+=" popup_layer",d.position={my:"left top",at:"left top+60",of:window},console.log(d),this.restorePersistentLayer(d)?!0:this.create(d,$(b).html(),!0)},this.setLayerFromAjax=function(a,b,c,d,e,f,g,h){var i=null;return a?(i=a,i.type="layer"):(i=this.getConfig("","layer"),i.width=800,i.height=600,i.modal=!0,i.autoOpen=!1),this.restorePersistentLayer(a)?!0:(i.dialogClass+=" popup_layer",this.setLayerByConfig(i.tag,i,'<span class="popupLoading"><span class="popupLoadingImage" >&nbsp;</span><span class="popupLoadingText" > Loading ... </span></span>'),g||(g=""),g+=' goPopup.setLayer("'+i.tag+'");',AjaxRequest(b,c,d,i.tag,e,f,g,h),i.tag)},this.restorePersistentLayer=function(a){if(a)var b=this.caoPopup[a.tag];else var b=!1;return b&&(!a.forceRefresh||a.contentTag&&a.contentTag==b.contentTag)?($("#"+a.tag).dialog(this.caoPopup[a.tag]).dialog("open"),a.tag):""}};